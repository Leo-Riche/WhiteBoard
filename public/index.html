<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tableau blanc collaboratif</title>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">

  <h1 class="text-2xl font-bold mb-4">🖌️ Tableau blanc collaboratif</h1>

  <div class="mb-2">
    <input type="color" id="colorPicker" class="w-12 h-12 p-0 border-none cursor-pointer">
    <select id="lineWidth" class="ml-2 p-1 border rounded">
      <option value="2">Fin</option>
      <option value="5" selected>Moyen</option>
      <option value="10">Épais</option>
    </select>
    <button id="clearBtn" class="ml-2 bg-red-500 text-white p-2 rounded">Nettoyer</button>
  </div>

  <canvas id="canvas" class="border rounded bg-white" width="800" height="500"></canvas>

  <script>
    const socket = io();
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    let drawing = false;

    // Paramètres du pinceau
    const colorPicker = document.getElementById('colorPicker');
    const lineWidth = document.getElementById('lineWidth');
    const clearBtn = document.getElementById('clearBtn');

    // Démarrer le dessin
    canvas.addEventListener('mousedown', (e) => {
      drawing = true;
      ctx.beginPath();
      ctx.moveTo(e.offsetX, e.offsetY);
    });

    // Dessiner
    canvas.addEventListener('mousemove', (e) => {
      if (!drawing) return;
      const color = colorPicker.value;
      const width = lineWidth.value;

      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.strokeStyle = color;
      ctx.lineWidth = width;
      ctx.lineCap = 'round';
      ctx.stroke();

      socket.emit('draw', { x: e.offsetX, y: e.offsetY, color, width });
    });

    // Arrêter le dessin
    canvas.addEventListener('mouseup', () => drawing = false);
    canvas.addEventListener('mouseleave', () => drawing = false);

    // Écouter les dessins des autres utilisateurs
    socket.on('draw', (data) => {
      ctx.strokeStyle = data.color;
      ctx.lineWidth = data.width;
      ctx.lineCap = 'round';
      ctx.lineTo(data.x, data.y);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(data.x, data.y);
    });

    // Nettoyer le tableau
    clearBtn.addEventListener('click', () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      socket.emit('clear');
    });

    socket.on('clear', () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    });
  </script>

</body>
</html>
